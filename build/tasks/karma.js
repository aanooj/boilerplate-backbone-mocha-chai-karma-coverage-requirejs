module.exports = function() {
  var framework;
  
  this.loadNpmTasks("grunt-karma");  

  return this.config("karma", {
    options: {
      
      basePath: process.cwd(),
      singleRun: true,
      captureTimeout: 7000,
      autoWatch: true,
      logLevel: "ERROR",

      reporters: ["dots","coverage"],
      
      browsers: ["PhantomJS"],
      
      frameworks: ["mocha"],
      
      plugins: ["karma-mocha", "karma-phantomjs-launcher", "karma-coverage"],
      
      preprocessors: {
        "app/**/*.js": "coverage"
      },
      
      coverageReporter: {
        type: "lcov",
        dir: "test/coverage"
      },
      
      files: [
        "bower_components/assert/assert.js", 
        "bower_components/requirejs/require.js", 
        "test/runner.js", 
        { pattern: "app/**/*.*", included: false }, 
        { pattern: "test/mocha/**/*.spec.js", included: false }, 
        { pattern: "bower_components/**/*.js", included: false }
      ]
    },
    
    daemon: {
      options: {
        singleRun: false
      }
    },
    
    run: {
      options: {
        singleRun: true
      }
    }
  });
};

// ---
// generated by coffee-script 1.9.0